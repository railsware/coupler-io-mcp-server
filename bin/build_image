#!/usr/bin/env bash

set -euo pipefail

ENVIRONMENT="${1:-development}"

if [ -z "$ENVIRONMENT" ]; then
  echo "Error: Environment argument is required" >&2
  echo "Usage: $(basename "$0") <environment>" >&2
  exit 1
fi

build_development() {
  echo "Building development image..."

  docker build \
    --build-arg NODE_ENV=development \
    -t coupler_mcp \
    -f docker/Dockerfile \
    .
}

build_staging() {
  echo "Building staging image..."

  docker build \
    --build-arg NODE_ENV=staging \
    -t coupler_mcp_staging:latest \
    -f docker/Dockerfile \
    .
}

build_production() {
  echo "Building production image..."

  # TODO
  # docker build \
  #   --build-arg NODE_ENV=production \
  #   -t coupler-io-mcp-server:latest \
  #   -f docker/Dockerfile \
  #   .
}

case "$ENVIRONMENT" in
  development)
    build_development
    ;;
  production)
    build_production
    ;;
  staging)
    build_staging
    ;;
  *)
    echo "Error: Unknown environment '$ENVIRONMENT'" >&2
    echo "Supported environments: development, staging, production" >&2
    exit 1
    ;;
esac
